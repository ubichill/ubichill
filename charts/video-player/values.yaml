# Default values for video-player
# This is a YAML-formatted file.

# Global settings
global:
  imageRegistry: "ghcr.io"
  imagePullPolicy: Always

# Backend application configuration
backend:
  enabled: true
  replicaCount: 3
  
  image:
    repository: "ubichill/video-player-backend"
    tag: "latest"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  
  # Resource management
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Auto-scaling configuration
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
    
    # Advanced scaling behavior
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 50
            periodSeconds: 60
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
          - type: Pods
            value: 2
            periodSeconds: 15
        selectPolicy: Max
  
  # Health checks
  healthcheck:
    enabled: true
    path: "/"
    livenessProbe:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3
  
  # Environment variables
  env:
    CORS_ORIGINS: "http://localhost:3000,http://localhost:3002"
    LOG_LEVEL: "INFO"
    REDIS_ENABLED: "false"  # Will be overridden if redis.enabled = true

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL

# Redis cache (optional)
redis:
  enabled: false  # Set to true to enable Redis caching
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      limits:
        memory: 256Mi
        cpu: 250m
      requests:
        memory: 128Mi
        cpu: 100m
  
  # Redis configuration
  commonConfiguration: |-
    maxmemory 256mb
    maxmemory-policy allkeys-lru
    appendonly yes

# Internal load balancer (if needed)
# This is separate from external ingress which is handled by infrastructure
internalLB:
  enabled: false
  service:
    type: LoadBalancer
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-internal: "true"  # AWS specific
      # Add your cloud provider specific annotations here

# Monitoring and observability
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Node affinity (optional - for multi-AZ deployment)
nodeAffinity:
  enabled: false
  preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      preference:
        matchExpressions:
        - key: topology.kubernetes.io/zone
          operator: In
          values:
          - us-west-2a
          - us-west-2b

# Tolerations (optional)
tolerations: []

# Node selector (optional)
nodeSelector: {}